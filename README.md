# Noir Flutter

noir_flutter is a Flutter package for generating and verifying [Noir](https://noir-lang.org/) zero-knowledge proofs using the Barretenberg backend.

The Flutter bindings are generated by the [**mopro CLI**](https://zkmopro.org/docs/getting-started) using the **Noir adapter**, which relies on a prebuilt Barretenberg backend.

To learn more about the original Rust implementation before generating bindings, please refer to [noir-rs](https://github.com/zkmopro/noir-rs).

## How to Import the Package

### Adding a package dependency to an app

1.  **Manual Edit (Required for local path or specific Git dependencies):**
    Open your `pubspec.yaml` file and add `noir_flutter` under `dependencies`.

          ```yaml
          dependencies:
              flutter:
                  sdk: flutter

              noir_flutter:
                  git:
                      url: https://github.com/zkmopro/noir_flutter
              # Or
              # mopro_flutter_package:
              #    path: ../noir_flutter
          ```

2.  **Update Circuit Asset:** Include your compiled Noir circuit `.json` and `.srs` file as an asset. Add the asset path to your `pubspec.yaml` under the `flutter:` section:

    ```yaml
    flutter:
        uses-material-design: true # Ensure this is present
        assets:
            # Add the directory containing your .json file(s)
            - assets/....json
            - assets/....srs
            # Or specify the file directly:
            # - assets/noir_multiplier2.json
    ```

    _Make sure the path points correctly to where you've placed your `.json` file within your Flutter project._

3.  **Install Package:** Run the following command in your terminal from the root of your Flutter project:

    ```bash
    flutter pub get
    ```

## How to Use the Package

### Import the package

```dart
import 'package:noir_flutter/src/rust/third_party/mopro_example_app_noir.dart';
import 'package:noir_flutter/src/rust/frb_generated.dart';
```

Update the main function to initialize the Rust library before running the app:

```dart
void main() async {
  await RustLib.init();
  runApp(const MyApp());
}
```

### Load circuit and srs

Please checkout [noir-rs](https://github.com/zkmopro/noir-rs) to see how to generate the circuit and the srs.

```dart
final circuitPath = await copyAssetToFileSystem(
      'assets/noir_multiplier2.json');
final srsPath = await copyAssetToFileSystem(
      'assets/noir_multiplier2.srs');
```

> [!NOTE]
> To learn how to read a `.json` file from an app, please refer to the [`copyAssetToFileSystem`](https://github.com/zkmopro/flutter-app/blob/a36ef9a78b35ea2618dafd4224c4f60e014e2e10/lib/main.dart#L584) function in the Flutter app.


### `getNoirVerificationKey`

```dart
const bool onChain = true;
const bool lowMemoryMode = false;
var inputs = ["3","5"];

final vk = await getNoirVerificationKey(
    circuitPath: circuitPath,
    srsPath: srsPath,
    onChain: onChain,
    lowMemoryMode: lowMemoryMode,
);
```

### `generateNoirProof`

```swift
final proofData = await generateNoirProof(
    circuitPath: circuitPath,
    srsPath: srsPath,
    inputs: inputs,
    onChain: onChain,
    vk: vk,
    lowMemoryMode: lowMemoryMode
);
```

### `verifyNoirProof`

```swift
final isValid = await verifyNoirProof(
    circuitPath: circuitPath,
    proof: proofData,
    onChain: onChain,
    vk: vk,
    lowMemoryMode: lowMemoryMode,
);
```

## How to Build the Package

### Generate the bindings using the Mopro CLI

This package relies on bindings generated by the Mopro CLI.
To learn how to build Mopro bindings, refer to the [Getting Started](https://zkmopro.org/docs/getting-started) section.
If you'd like to generate custom bindings for your own circuits or proving schemes, check out the guide on how to use the Mopro CLI: [Rust Setup for Android/iOS Bindings](https://zkmopro.org/docs/setup/rust-setup#setup-any-rust-project).

Choose **Flutter** to build the bindings, or run

```sh
mopro build --platforms flutter
```

to generate the flutter package.

Then, replace the entire bindings directory `mopro_flutter_package` with your generated files in the current folder:

```t
├── android
├── cargokit
├── flutter_rust_bridge.yaml
├── ios
├── lib
├── pubspec.yaml
└── rust
```

or running e.g.

```sh
cp -R \
  mopro_flutter_bindings/android \
  mopro_flutter_bindings/cargokit \
  mopro_flutter_bindings/flutter_rust_bridge.yaml \
  mopro_flutter_bindings/ios \
  mopro_flutter_bindings/lib \
  mopro_flutter_bindings/pubspec.yaml \
  mopro_flutter_bindings/rust \
  noir_flutter/
```

### Flutter Example App

-   Open the example app that uses the defined flutter package in the [`example/`](example) folder
    ```sh
    cd example
    ```
-   Install the dependencies
    ```sh
    flutter pub get
    ```
-   Open an iOS simulator/device or an Android emulator/device and run the example app
    ```sh
    flutter run
    ```
-   Clean the cache if you update the bindings and it throws errors
    ```sh
    flutter clean
    ```

> ![WARNING]
> Bindings generated by the mopro CLI use local crate paths by default, which makes them non-reproducible on other devices.
> To make the build reproducible, publish your Rust crate and reference it via a Git source instead of a local path at [here](https://github.com/vivianjeng/mopro_flutter_package/blob/983ebcb60103c961c870634d3f3df54d6d6dc564/rust/Cargo.toml#L7).
> If you’d like to help address this limitation, contributions are welcome — see https://github.com/zkmopro/mopro/issues/647
> .

## Community

-   X account: <a href="https://twitter.com/zkmopro"><img src="https://img.shields.io/twitter/follow/zkmopro?style=flat-square&logo=x&label=zkmopro"></a>
-   Telegram group: <a href="https://t.me/zkmopro"><img src="https://img.shields.io/badge/telegram-@zkmopro-blue.svg?style=flat-square&logo=telegram"></a>

## Acknowledgements

This work was initially sponsored by a joint grant from [PSE](https://pse.dev/) and [0xPARC](https://0xparc.org/). It is currently incubated by PSE.
